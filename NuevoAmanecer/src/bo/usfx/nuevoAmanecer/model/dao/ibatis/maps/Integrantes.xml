<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Integrantes">

	<sql id="PropertiesIntegrantes">
		SELECT 	codigo_integrante, 
				apellido_paterno, 
				apellido_materno, 
				nombres, 
				sexo, edad
		FROM integrante
  </sql>

	<select id="ObtenerIntegrantes" resultClass="Integrantes">
		<include refid="PropertiesIntegrantes" />
		<dynamic prepend="WHERE">
			<isNotNull property="codigo_integrante">
				 codigo_integrante = #codigo_integrante#
		</isNotNull>
		</dynamic>
		ORDER BY admiapellido_paterno ASC
	</select>

	<select id="VerificarIdIntegrantes" resultClass="java.lang.Integer">
		SELECT count(codigo_integrante)
		FROM Integrante
		WHERE codigo_integrante = #codigo_integrante#;
  </select>

   <select id="VerificarExistenciaDescripcionIntegrantes" resultClass="java.lang.Integer">
		SELECT count(*)
		FROM Integrante
		WHERE UPPER(TRIM(apellido_paterno) || RTRIM(apellido_materno) || RTRIM(nombres)) = UPPER(TRIM(#apellido_paterno#) || RTRIM(#apellido_materno#) || RTRIM(#nombres#))
  </select> 

   <select id="BuscarIntegrantes" resultClass="Integrantes">
      <include refid="PropertiesIntegrantes" />
      <dynamic prepend="WHERE">
		  <iterate property="keywordList" open="(" close=")" conjunction="OR">
			cast(codigo_integrante as char(100)) like #keywordList[]# OR
			UPPER(apellido_paterno) like UPPER(#keywordList[]#) OR
			UPPER(apellido_materno) like UPPER(#keywordList[]#) OR
			UPPER(nombres) like UPPER(#keywordList[]#)
		  </iterate>
		  <isGreaterThan property="filtroEntero" compareValue="0" prepend="AND">
				And codigo_integrante not in
				(SELECT codigo_integrante 
				FROM integra
				WHERE codigo_programa = #filtroEntero#)
			</isGreaterThan>
    </dynamic>
    ORDER BY apellido_paterno ASC
  </select>
	<!-- Edicion de la Clase Proceso -->

	<insert id="InsertarIntegrantes" parameterClass="Integrantes">
		INSERT INTO integrante(apellido_paterno, apellido_materno, nombres, 
            sexo, edad)
		VALUES(#apellido_paterno#, #apellido_materno#, #nombres#, 
            #sexo#, #edad#)
  </insert>

	<update id="ModificarIntegrantes" parameterClass="Integrantes">
		UPDATE Integrante
		<dynamic prepend="SET">
			<isNotNull prepend="," property="apellido_paterno">apellido_paterno=UPPER(#apellido_paterno#)</isNotNull>
			<isNotNull prepend="," property="apellido_materno">apellido_materno=UPPER(#apellido_materno#)</isNotNull>
			<isNotNull prepend="," property="nombres">nombres=UPPER(#nombres#)</isNotNull>			
			<isNotNull prepend="," property="sexo">sexo=#sexo#</isNotNull>
			<isNotNull prepend="," property="edad">edad=#edad#</isNotNull>			
		</dynamic>
		WHERE codigo_integrante = #codigo_integrante#;
	</update>
	<delete id="EliminarIntegrantes">
		DELETE FROM Integrante 
		WHERE codigo_integrante = #codigo_integrante#;
  </delete>
   <parameterMap id="parametros" class="java.util.Map">
		<parameter property="a" />
	</parameterMap>
	<procedure id="obtenerUltimoIdIntegrantes" parameterMap="parametros"
		resultClass="int">
		{ call ObtenerUltimoIdIntegrantes(?) }
  </procedure> 
</sqlMap>